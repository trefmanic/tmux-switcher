<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>tmux Window Switcher</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="icon" type="image/png" sizes="64x64" href="{{ url_for('static', filename='favicon.png') }}">
  <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}">
</head>
<body><div class="container">
  <h1>tmux windows</h1>
  <div id="wins"></div>

<h1>new tmux window</h1>
<div class="newwin">
  <input id="cmd" class="cmdinput" type="text" placeholder="command...">
  <button class="cmdbtn" onclick="runNew()" title="Run tmux new-window with this command. COULD BE DANGEROUS!">&gt;</button>
</div>

<script>
async function runNew() {
  const cmd = document.getElementById('cmd').value.trim();
  if (!cmd) return;

  await fetch('/new', {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({ cmd })
  });

  document.getElementById('cmd').value = '';
  refresh();
}
async function refresh() {
  const resp = await fetch('/windows');
  const data = await resp.json();
  const container = document.getElementById('wins');
  container.innerHTML = '';
  data.forEach(win => {
    const wrap = document.createElement('div');
    wrap.className = 'entry';
    const a = document.createElement('a');
    a.className = 'btn';
    a.href = `/switch/${win.id}`;
    a.textContent = `${win.id}: ${win.name}`;
    a.title = 'Switch to this window';
    a.style.flex = '1';

    const close = document.createElement('button');
    close.className = 'close';
    close.textContent = 'âœ•';
    close.title = 'Close this window';
    close.onclick = async (e) => {
      e.preventDefault();
      e.stopPropagation();
      if (!confirm('Kill tmux window ' + win.name + '?')) return;
      await fetch(`/close/${win.id}`, { method: 'POST' });
      refresh();
    };
    wrap.appendChild(a);
    wrap.appendChild(close);
    container.appendChild(wrap);
  });
}
// initial load
refresh();
setInterval(refresh, 3000);
</script>
</div></body>
</html>